# vue3 对比 vue2 的变化

- 性能优化
  - 使用 `Proxy` 替代了 `Object.defineProperty` 实现响应式。因为 `defineProperty` 需要对属性进行递归重写添加访问器属性，处理复杂数据结构时性能差，而且无法监控属性的添加与删除，只能通过 `$set` `$delete` 方法实现。 对数组的处理也不佳。
  - 模板编译优化。 给动态节点增加了 patchFlag 标记；对静态节点进行静态提升，预字符串化；对事件回调函数进行缓存处理等等
  - diff算法优化，全量diff算法中采用最长递增子序列减少节点的移动。在非全量diff算法中只比较动态节点， 通过 `patchFlag` 标记更新动态的部分。
- 体积优化
  - Vue3移除了不常用的API
    - 移除 `inline-template`
    - `$on` `$off` `$once` (需要的话，可以使用 `mitt` 库实现)
    - 删除过滤器
    - `$children` 移除 (可以通过 `provide` , `inject` )
    - 移除 `.sync` `.native` 修饰符( `.sync` 通过 `v-model:xxx` 实现， `.native` 为vue3中的默认行为)，以及不再支持 `keycode` 作为 `v-on` 修饰符
    - 移除全局API。`Vue.component` `Vue.use` `Vue.directive`。 全部挂载到实例上。
    - 通过构建工具 Tree-shaking 机制实现按需引入， 减少用户打包后体积。
- 支持自定义渲染器
  - 用户可以自定义渲染API打到跨平台的目的。 扩展能力更强，无需改造源码。
- TypeScript支持
  - 源码采用TS编写，API对TS的支持更加友好。
- 源码结构变化
  - Vue3源码采用 monorepo 方式进行管理（pnpm workspace），将模块拆分到 package 目录中，解耦后可单独使用。