# SPA 加载优化

## 原因

- 网络延迟问题
- 资源文件体积过大
- 资源重复请求
- 加载脚本的时候，堵塞页面渲染

## 解决方案

- 减小入口文件体积
    - 路由懒加载
    - 模块使用局部加载，tree-shaking
- 静态资源本地缓存
    - http缓存,设置`Cache-Control`，`Last-Modified`，`Etag`等响应头
    - 采用`Service Worker`离线缓存
    - 合理使用localStorage，缓存一些不易更改的配置信息
- UI框架按需加载
- 图片资源的压缩
    - 小图使用base64 iconfont 雪碧图
- 防止模块重复打包
    - 通过设置将出现多次的包抽离出来
- 开启GZip压缩
- 使用SSR

![](https://static.vue-js.com/4fafe900-3acc-11eb-85f6-6fac77c0c9b3.png)

## 其他
- 使用路由懒加载、异步组件，实现组件拆分，减少入口文件体积大小,优化体验骨架屏
- 抽离公共代码，采用 splitChunks 进行代码分割。
- 组件加载采用按需加载的方式。
- 静态资源缓存，采用 HTTP 缓存 （强制缓存、对比缓存）、使用 localStorage 实现缓存资源。
- 图片资源的压缩，雪碧图、对小图片进行 base64 减少 http 请求。
- 打包时开启 gzip 压缩处理 `compression-webpack-plugin` 插件
- 静态资源采用 CDN 提速。终极的手段
- 使用 SSR 对首屏做服务端渲染。