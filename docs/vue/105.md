# Vue.mixin 的使用场景和原理

## 1.1 概念

minxin 可以用来扩展组件，将公共逻辑进行抽离。在需要该逻辑时进行“混入”，采用策略模式针对不同的属性进行合并。如果混入的数据和本身组件中的数据冲突，会采用“就近原则”，以组件的数据为准。

::: warning
mixin 中有很多缺陷 "命名冲突问题"、"数据来源问题"，Vue3 采用 CompositionAPI 提取公共逻辑非常方便。
:::

## 1.2 混入方式

在Vue中我们可以局部混入跟全局混入。一般情况下全局混入用于编写插件。局部混入用于复用逻辑。

``` js

// vue-router 全局混入代码
Vue.mixin({
    beforeCreate () {
      if (isDef(this.$options.router)) {
        this._routerRoot = this
        this._router = this.$options.router
        this._router.init(this)
        Vue.util.defineReactive(this, '_route', this._router.history.current)
      } else {
        this._routerRoot = (this.$parent && this.$parent._routerRoot) || this
      }
      registerInstance(this, this)
    },
    destroyed () {
      registerInstance(this)
    }
  })
```

## 1.3 合并策略
核心就是：对象的合并处理。

- `props、methods、inject、computed` 同名时会被替换
- `data` 会被合并
- 生命周期和 `watch` 方法 会被合并成队列，`mixin` 中的生命周期方法将会先执行。
- `components、directives、filters` 会在原型链上叠加

> 组件的扩展除了 mixin 之外还有一个属性叫 extends，但是不怎么常用~~~。